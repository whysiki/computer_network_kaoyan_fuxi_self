# 标准访问控制列表的配置

![1697538521307](image/华为ACL配置/1697538521307.png)

## 1. source-wildcard

与子网掩码按位取反

![1697539246768](image/华为ACL配置/1697539246768.png)

## 2. ACL规则匹配顺序

![1697539539947](image/华为ACL配置/1697539539947.png)

首先系统会查找设备上是否配置了ACL。

* 如果ACL不存在，则返回ACL匹配结果为：不匹配。
* 如果ACL存在，则查找设备是否配置了ACL规则。
  * 如果规则不存在，则返回ACL匹配结果为：不匹配。
  * 如果规则存在，则系统会从ACL中编号最小的规则开始查找。
* 如果匹配上了permit规则，则停止查找规则，并返回ACL匹配结果为：匹配（允许）。
* 如果匹配上了deny规则，则停止查找规则，并返回ACL匹配结果为：匹配（拒绝）。
* 如果未匹配上规则，则继续查找下一条规则，以此循环。如果一直查到最后一条规则，报文仍未匹配上，则返回ACL匹配结果为：不匹配。

从整个ACL匹配流程可以看出，报文与ACL规则匹配后，会产生两种匹配结果：“匹配”和“不匹配”。

* 匹配（命中规则）：指存在ACL，且在ACL中查找到了符合匹配条件的规则。不论匹配的动作是“permit”还是“deny”，都称为“匹配”，而不是只是匹配上permit规则才算“匹配”。
* 不匹配（未命中规则）：指不存在ACL，或ACL中无规则，再或者在ACL中遍历了所有规则都没有找到符合匹配条件的规则。以上三种情况，都叫做“不匹配”。

## 3. ACL规则匹配方式

![1697539394885](image/华为ACL配置/1697539394885.png)

### 3. 配置顺序

![1697539409090](image/华为ACL配置/1697539409090.png)

### 3. 2 自动顺序

![1697539450235](image/华为ACL配置/1697539450235.png)

![1697539472635](image/华为ACL配置/1697539472635.png)

对于高级访问控制规则

范围小的排在前面, 深度优先

先协议 -> 源地址 -> 目的地址 -> 端口号

![1697539657773](image/华为ACL配置/1697539657773.png)

### 3.3 访问控制列表的组合

auto 与 config的差别

![1697540062349](image/华为ACL配置/1697540062349.png)

![1697540012410](image/华为ACL配置/1697540012410.png)

![1697540028112](image/华为ACL配置/1697540028112.png)

![1697540043064](image/华为ACL配置/1697540043064.png)

# 拓展访问控制列表的配置命令

## tcp/udp

![1697540189786](image/华为ACL配置/1697540189786.png)

## icmp

![1697540207006](image/华为ACL配置/1697540207006.png)

## igmp

![1697540239574](image/华为ACL配置/1697540239574.png)

## operator

![1697540366277](image/华为ACL配置/1697540366277.png)

# 华为acl配置步骤

1. **进入系统视图**

![1697540900676](image/华为ACL配置/1697540900676.png)

system-view

2. **创建acl**

![1697541010471](image/华为ACL配置/1697541010471.png)

acl number 200

acl 2000

//默认匹配顺序为config

acl 2000 match-order auto

```
[Switch] acl 3001
[Switch-acl-adv-3001] rule deny ip source 10.1.1.0 0.0.0.255 destination 10.1.2.0 0.0.0.255  //禁止研发部访问市场部
[Switch-acl-adv-3001] quit
```

3. **创建acl规则**

![1697541225447](image/华为ACL配置/1697541225447.png)

rule 2000 deny 10.10.1.2 0.0.0.255

rule 2000 deny 10.10.1.2 0.0.0.255

rule 3000 deny 10.10.3.0 0.0.0.255 destination 10.10.2.0 0.0.0.255

rule 5 deny tcp source 192.168.1.12 0 destination-port eq www

4. **应用acl到对应的接口**

![1697541439798](image/华为ACL配置/1697541439798.png)

//进入接口配置

interface GigabitEnthernet 0/0/1

//入站口方向应用acl 200

traffic-filter inbound acl 200

# acl应用规则

![1697541624072](image/华为ACL配置/1697541624072.png)

# 示例

## 访问外网限制

![1697542240037](image/华为ACL配置/1697542240037.png)

![1697542270501](image/华为ACL配置/1697542270501.png)

![1697542326823](image/华为ACL配置/1697542326823.png)

![1697542307553](image/华为ACL配置/1697542307553.png)

`0` 是源地址的通配符掩码，表示匹配源 IP 地址的所有位。

 **`destination-port eq www`** ：目的端口匹配条件。

* `destination-port` 指定了目的端口的匹配条件。
* `eq www` 表示要匹配的目的端口是 `www`，通常是指 Web 服务的默认端口 80。
* 这个条件要求目的端口必须是 `www`（端口 80）

![1697542354502](image/华为ACL配置/1697542354502.png)

![1697542554171](image/华为ACL配置/1697542554171.png)

## 交换机进行acl配置例子

![1697543471510](image/华为ACL配置/1697543471510.png)

![1697543483269](image/华为ACL配置/1697543483269.png)

![1697543511138](image/华为ACL配置/1697543511138.png)

![1697543494339](image/华为ACL配置/1697543494339.png)

![1697543519454](image/华为ACL配置/1697543519454.png)

![1697543526028](image/华为ACL配置/1697543526028.png)

## 交换机应用acl

![1697543613728](image/华为ACL配置/1697543613728.png)
