IEEE 802.1Q 是一种用于虚拟局域网（VLAN）标记的协议，

它允许网络管理员将一个以太网帧标记为属于一个特定的 VLAN。

这个标记是在帧的头部添加的，以指示该帧属于哪个 VLAN。802.1Q协议是 VLAN 实现中最常用的标准之一。

以下是关于802.1Q协议的详细讲解：

### 1. **VLAN标记格式：**

802.1Q标记是在以太网帧头部添加的额外的4个字节，其格式如下：

- **TPID（Tag Protocol Identifier）：** 占两个字节，用于指示后面的帧是802.1Q帧。其值是0x8100。
- **T/C（Tag Control）：** 占两个字节，包含优先级（3 bits）、CFI（Canonical Format Identifier，1 bit）、和 VLAN ID（12 bits）。

整个802.1Q标记的结构如下：

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      TPID (0x8100)      |   T/C    |               VLAN ID               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### 2. **VLAN ID（VID）：**

VLAN ID（VLAN标识符）是12位字段，允许定义最多4096个不同的VLAN。

其中，VLAN ID 0和4095有特殊用途，0表示默认的VLAN，而4095表示全局保留。

### 3. **帧的处理过程：**

- **发送端：** 在发送端，当一个帧要被发送到一个VLAN时，802.1Q标记将会被添加到帧的头部。
- **接收端：** 在接收端，交换机或路由器会检查802.1Q标记，根据VLAN ID决定将帧传递到哪个VLAN。

### 4. **优先级和CFI：**

802.1Q标记中的3位优先级字段和1位CFI字段一起用于支持QoS（Quality of Service）。

这允许管理员为不同的帧分配不同的优先级。

### 5. **Trunk端口：**

在网络中，Trunk端口是指能够传递多个VLAN数据的端口。

在Trunk链路上，所有的帧都会被802.1Q标记，以便在网络中正确地传递和识别它们。

### 6. **802.1Q在网络中的应用：**

802.1Q标准广泛应用于企业网络中，以提供灵活的VLAN支持。它允许将不同的用户和服务划分到不同的VLAN中，从而实现逻辑上的隔离和更好的网络管理。

总体而言，802.1Q协议在VLAN的实现中发挥着关键作用，为网络提供了更好的可扩展性、管理性和安全性。
